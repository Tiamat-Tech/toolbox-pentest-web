# 🔬 Technical hints about code review

> 📡 **Note**: Use the TOC provided by the GitHub MD file rendering named `Outline`.

🏡 [Back to home](README.md).

📖 [Methodology for code review](0_METHODOLOGIES.md#methodology-for-code-review).

## Automated review using SemGrep

> 💡 This [dedicated toolbox](https://github.com/righettod/toolbox-codescan) can be used.

🛑 Always ensure that the option `--metrics off` is specified! 🛑 

* [CLI reference](https://semgrep.dev/docs/cli-reference/).
* [GitHub repository](https://github.com/returntocorp/semgrep).
* [Notice about collected metrics](https://semgrep.dev/docs/metrics).

💻 Install via `python3 -m pip install semgrep`.

💻 Scan commands:

```shell
# Scan using the "r2c-security-audit" profile:
# "Scan code for potential security issues that require additional review."
# See https://semgrep.dev/p/r2c-security-audit
$ semgrep scan --config "p/r2c-security-audit" --force-color --text --metrics off --disable-version-check --oss-only
# Scan using the "default" profile:
# "The default ruleset configured in Semgrep App."
# See https://semgrep.dev/p/default
$ semgrep scan --config "p/default" --force-color --text --metrics off --disable-version-check --oss-only
```

## Manual review using grep commands

### Java

* [Beans validation - RI reference](https://docs.jboss.org/hibernate/stable/validator/reference/en-US/html_single/#_validating_constraints).
* [Beans validation - Collection of built-in constraints](https://jakarta.ee/specifications/bean-validation/3.0/apidocs/jakarta/validation/constraints/package-frame).

💡 Notes:

* JAXB, by default, does not allow `http`, `https` or `file` protocols during unmarshalling operations: Grant must be expliclty given.
* `Preferences.importPreferences(xmlFile)` is not prone to XXE because it strictly validate that the url is equals to `http://java.sun.com/dtd/preferences.dtd`.

💻 Useful commands to find type of processing (excludes test related content):

```shell
# Find if input validation is in place using beans validation constraints
grep -E "@(Pattern|Size|Digits|Email|Negative|Positive|Length|Range)" -rn --exclude-dir=test --include=\*.java .
# Find if input validation is in place using regex
grep -F "Pattern" -rn --exclude-dir=test --include=\*.java .
# Find if input validation is in place using regex and focusing on regular expressions defined
grep -F "Pattern.compile(" -rn --exclude-dir=test --include=\*.java .
# Identify XML processing to check for exposure to XXE
grep -E "(DocumentBuilderFactory|XMLInputFactory|TransformerFactory|JAXBContext)" -rn --exclude-dir=test --include=\*.java .
# Identify cryptography related processing to check for weaknesses in usage/implementation
grep -E "(MessageDigest|Cipher|ParameterSpec|SecretKey|PrivateKey|PublicKey|KeyGenerator)" -rn --exclude-dir=test --include=\*.java .
# Identify system command execution
grep -F ".exec(" -rn --exclude-dir=test --include=\*.java .
```

💻 Useful commands to find type of files (excludes test related content):

```shell
# Find keystores or truststores
find . -not -path "*/test/*" -type f -name *.jks
# Find configuration files via properties files
find . -not -path "*/test/*" -type f -name *.properties
```
