#!/usr/bin/env python
import json
import colorama
import sys
from termcolor import colored
from tabulate import tabulate

'''
Quick script to format the result of a Gitleaks JSON report (https://github.com/gitleaks/gitleaks):
    gitleaks detect --config gitleaks-custom-config.toml --no-banner --report-format json --report-path report.json --source $(pwd) --verbose
    python generate-report-gitleaks.py report.json

Dependencies:
    pip install tabulate colorama termcolor
'''

report = sys.argv[1]
colorama.init()
with open(report) as f:
    content = f.read()
leaks = json.loads(content)
table_rows = []
table_headers = ["File", "StartLine", "Commit", "Tags", "Secret"]
for leak in leaks:
    table_row = []
    for header in table_headers:
        if header == "Tag":
            table_row.append(",".join(leak[header]))
        elif header == "Commit":
            table_row.append(leak[header][:12])
        elif header == "Secret":
            v = leak[header][:40]
            v = v.replace("\n","")
            v = v.replace("\r","")
            v = v.replace("\t","")
            table_row.append(v) 
        else:
            table_row.append(leak[header])
    table_rows.append(table_row)
table_rows.sort()
print(colored(f"[+] Leaks ({len(table_rows)} founds):", "yellow"))
print(tabulate(table_rows, headers=table_headers))
