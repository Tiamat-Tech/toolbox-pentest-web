#!/bin/bash
####################################################################
# Script to identify the domains associated to an IP V4 address.
#
# References used:
#	 https://www.cloudflare.com/learning/dns/dns-records/dns-ptr-record/
#
# Requirements in terms of software:
#	apt install dnsutils
#	https://github.com/projectdiscovery/subfinder
####################################################################

# Constant
WORK_FILE="/tmp/work.tmp"

# Entry point
if [ "$#" -lt 2 ]; then
	script_name=$(basename "$0")
	echo "Usage:"
	echo "   $script_name [IPV4_ADDRESS] [BASE_DOMAIN]"
	echo ""
	echo "Call example:"
	echo "    $script_name 213.186.33.87 righettod.eu"
    exit 1
fi

# Utility functions
function write_step(){
	echo -e "\e[93m$1\e[0m"
}

# Main processing
ip=$1
base_domain=$2
write_step "[*] Try using PTR DNS record..."
dig -x $ip +short
write_step "[*] Try using subfinder against the base domain provided..."
subfinder -duc -silent -all -d $base_domain > $WORK_FILE
dig A +multiline +noall +answer +nocmd -f $WORK_FILE | grep -F "$ip" | sort -u
rm $WORK_FILE

