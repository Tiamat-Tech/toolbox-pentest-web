#!/bin/bash
###############################################################
# Script to perform a vulnerability scan against an IP/domain
###############################################################
if [ "$#" -lt 1 ]; then
    script_name=$(basename "$0")
    echo "Usage:"
    echo "   $script_name [IP or domain]"
    echo ""
    echo "Call example:"
    echo "    $script_name righettod.eu"
	echo "    $script_name 10.10.10.10"
    exit 1
fi
target="$1"
limit=40
timeout=30
retries=5
nmap_reports="/tools/reports/scan-nmap.txt"
nuclei_input="/tools/reports/targets.txt"
nuclei_cve_reports="/tools/reports/scan-nuclei-cve.txt"
nuclei_other_reports="/tools/reports/scan-nuclei-other.txt"
echo -e "\e[93m[+] Discover open TCP ports...\e[0m"
nmap --open -Pn -p- -oN "$nmap_reports" $target
grep -Po "[0-9]+/tcp" "$nmap_reports" | cut -d'/' -f1 | sort -u | awk -v ip="$target" '{print ip ":" $0}' > $nuclei_input
echo -e "\e[93m[+] Scan target for CVE...\e[0m"
nuclei -o "$nuclei_cve_reports" -silent -tags cve,cves -exclude-type dns,whois,ssl,code,javascript -follow-redirects -rate-limit $limit -concurrency $limit -timeout $timeout -retries $retries -disable-update-check -l "$nuclei_input"
echo -e "\e[93m[+] Scan target for other contents/issues...\e[0m"
nuclei -o "$nuclei_other_reports" -silent -exclude-id httponly-cookie-detect,xss-deprecated-header,http-missing-security-headers -exclude-type dns,whois,ssl,code,javascript -exclude-tags cve,cves -follow-redirects -rate-limit $limit -concurrency $limit -timeout $timeout -retries $retries -disable-update-check -l "$nuclei_input"
