#!/usr/bin/env python
import argparse
import json
from urllib.parse import parse_qs

"""
Script to generate a JSON string from a string containing www form URL encoded data.

Based on the following references: 
    https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST
"""

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="Script to generate a JSON string from a string containing www form URL encoded data.")
    required_params = parser.add_argument_group("required named arguments")
    required_params.add_argument("-i", action="store", dest="wwwform", help="String containing www form URL encoded data.", required=True)
    args = parser.parse_args()
    parsed_data = parse_qs(args.wwwform, keep_blank_values=True)
    result = {}
    for key, value in parsed_data.items():
        keys = key.replace("]", "").split("[")
        current = result
        for k in keys[:-1]:
            current = current.setdefault(k, {})
        current[keys[-1]] = value[0] if len(value) == 1 else value
    print(json.dumps(result, indent=1))
